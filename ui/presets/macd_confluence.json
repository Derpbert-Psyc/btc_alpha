{
  "display_name": "MACD Confluence",
  "description": "Multi-timeframe MACD alignment with momentum trigger, ATR-based sizing, Choppiness gating, and layered exits.",
  "spec_version": "1.5.2",
  "target_engine_version": "1.8.0",
  "target_instrument": "BTCUSDT",
  "target_variant": "perp",
  "archetype_tags": ["trend_following", "multi_timeframe"],
  "indicator_instances": [
    {
      "label": "price_1h",
      "indicator_id": "ema",
      "timeframe": "1h",
      "parameters": {"period": 1},
      "outputs_used": ["ema"],
      "role": "price",
      "group": "Trend"
    },
    {
      "label": "macd_15m",
      "indicator_id": "macd",
      "timeframe": "15m",
      "parameters": {"fast_period": 12, "slow_period": 26, "signal_period": 9},
      "outputs_used": ["macd_line", "signal_line", "histogram"],
      "role": "trigger",
      "group": "Trend"
    },
    {
      "label": "macd_1h",
      "indicator_id": "macd",
      "timeframe": "1h",
      "parameters": {"fast_period": 12, "slow_period": 26, "signal_period": 9},
      "outputs_used": ["macd_line", "signal_line", "histogram"],
      "role": "filter",
      "group": "Trend"
    },
    {
      "label": "macd_4h",
      "indicator_id": "macd",
      "timeframe": "4h",
      "parameters": {"fast_period": 12, "slow_period": 26, "signal_period": 9},
      "outputs_used": ["macd_line", "signal_line"],
      "role": "filter",
      "group": "Trend"
    },
    {
      "label": "atr_15m",
      "indicator_id": "atr",
      "timeframe": "15m",
      "parameters": {"period": 14},
      "outputs_used": ["atr"],
      "role": "sizing",
      "group": "Volatility"
    },
    {
      "label": "chop_1h",
      "indicator_id": "choppiness",
      "timeframe": "1h",
      "parameters": {"period": 14},
      "outputs_used": ["choppiness"],
      "role": "gate",
      "group": "Regime"
    }
  ],
  "entry_rules": [
    {
      "label": "Long Entry — MACD Confluence",
      "direction": "LONG",
      "evaluation_cadence": "15m",
      "conditions": [
        {
          "indicator": "macd_15m",
          "output": "histogram",
          "operator": ">",
          "value": 0
        }
      ],
      "condition_groups": [
        {
          "label": "Higher TF alignment",
          "conditions": [
            {
              "indicator": "macd_1h",
              "output": "macd_line",
              "operator": ">",
              "value": 0
            },
            {
              "indicator": "macd_4h",
              "output": "macd_line",
              "operator": ">",
              "value": 0
            }
          ]
        }
      ]
    },
    {
      "label": "Short Entry — MACD Confluence",
      "direction": "SHORT",
      "evaluation_cadence": "15m",
      "conditions": [
        {
          "indicator": "macd_15m",
          "output": "histogram",
          "operator": "<",
          "value": 0
        }
      ],
      "condition_groups": [
        {
          "label": "Higher TF alignment",
          "conditions": [
            {
              "indicator": "macd_1h",
              "output": "macd_line",
              "operator": "<",
              "value": 0
            },
            {
              "indicator": "macd_4h",
              "output": "macd_line",
              "operator": "<",
              "value": 0
            }
          ]
        }
      ]
    }
  ],
  "exit_rules": [
    {
      "label": "Stop Loss",
      "exit_type": "STOP_LOSS",
      "applies_to": ["LONG", "SHORT"],
      "evaluation_cadence": "1m",
      "mode": "FIXED_PERCENT",
      "value_long_bps": 200,
      "value_short_bps": 200,
      "conditions": []
    },
    {
      "label": "Trailing Stop",
      "exit_type": "TRAILING_STOP",
      "applies_to": ["LONG", "SHORT"],
      "evaluation_cadence": "1m",
      "mode": "ATR_MULTIPLE",
      "value_long_bps": 300,
      "value_short_bps": 300,
      "conditions": []
    },
    {
      "label": "Time Limit",
      "exit_type": "TIME_LIMIT",
      "applies_to": ["LONG", "SHORT"],
      "evaluation_cadence": "15m",
      "time_limit_bars": 96,
      "time_limit_reference_cadence": "15m",
      "conditions": []
    },
    {
      "label": "Signal Exit — MACD Cross",
      "exit_type": "SIGNAL",
      "applies_to": ["LONG", "SHORT"],
      "evaluation_cadence": "15m",
      "conditions": [
        {
          "indicator": "macd_15m",
          "output": "histogram",
          "operator": "crosses_below",
          "value": 0
        }
      ]
    }
  ],
  "gate_rules": [
    {
      "label": "Choppiness Gate",
      "exit_policy": "HOLD",
      "conditions": [
        {
          "indicator": "chop_1h",
          "output": "choppiness",
          "operator": "<",
          "value": 61.8
        }
      ]
    }
  ],
  "execution_params": {
    "direction": "BOTH",
    "leverage": 1,
    "sizing_mode": "RISK_FRACTION",
    "risk_fraction_bps": 100,
    "flip_enabled": true,
    "funding_model": {
      "enabled": false,
      "interval_hours": 8,
      "rate_source": "FIXED",
      "rate_per_interval_bps": 1,
      "credit_allowed": false
    }
  },
  "metadata": {
    "thesis": "Multi-timeframe MACD alignment filters noise. 15m trigger for entries, 1h+4h for directional bias. Choppiness gate avoids ranging markets.",
    "known_risks": [
      "Whipsaw in sideways markets despite chop filter",
      "Slow 4h alignment may miss early trend entries",
      "Fixed stop loss may be too tight in high-vol environments"
    ],
    "triage_sensitive_params": [
      {"param": "macd_15m.fast_period", "default": 12, "min": 8, "max": 16},
      {"param": "exit_rules.0.value_long_bps", "default": 200, "min": 100, "max": 400},
      {"param": "chop_1h.period", "default": 14, "min": 7, "max": 21}
    ],
    "research_notes": [],
    "user_tags": ["trend", "macd", "multi_tf"]
  }
}
